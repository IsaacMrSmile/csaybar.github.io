<!DOCTYPE html>
<html lang="en-us">

  <head>
  <meta charset="utf-8">
  <meta name="robots" content="all,follow">
  <meta name="googlebot" content="index,follow,snippet,archive">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  <title>Raster resampling in R</title>
  <meta name="author" content="Cesar Aybar" />
  
  
  
  
  <meta name="keywords" content="devows, hugo, go, GdalUtils, raster, furrr, plotly, rasterVIS">
  
  
  <meta name="description" content="Site template made by devcows using hugo">

  <meta name="generator" content="Hugo 0.59.1" />

  
  <link rel="stylesheet" href="https://cdn.rawgit.com/jpswalsh/academicons/master/css/academicons.min.css">

  <link href='//fonts.googleapis.com/css?family=Roboto:400,100,100italic,300,300italic,500,700,800' rel='stylesheet' type='text/css'>

  
  <link rel="stylesheet" href="//use.fontawesome.com/releases/v5.11.2/css/all.css">
  <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

  
  <link href="/css/animate.css" rel="stylesheet">

  
  
    <link href="/css/style.blue.css" rel="stylesheet" id="theme-stylesheet">
  

  
  <link href="/css/custom.css" rel="stylesheet">

  
  
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
        <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  

  
  <link rel="shortcut icon" href="/img/favicon.ico" type="image/x-icon" />
  <link rel="apple-touch-icon" href="/img/apple-touch-icon.png" />

  
  <link href="/css/owl.carousel.css" rel="stylesheet">
  <link href="/css/owl.theme.css" rel="stylesheet">

  
  <link rel="alternate" href="/index.xml" type="application/rss+xml" title="csaybar">

  
  
  
  
  
  
  
  <meta property="og:locale" content="en_us">
  <meta property="og:site_name" content="csaybar">
  <meta property="og:title" content="Raster resampling in R">
  <meta property="og:type" content="article">
  <meta property="og:url" content="/blog/2018/12/05/resample/" />
  <meta property="og:description" content="Site template made by devcows using hugo">
  <meta property="og:image" content="/img/banners/01_banner_resample.png">
  <meta property="og:image:type" content="image/png">
  
  
  
    <meta property="og:image:width" content="390">
    <meta property="og:image:height" content="277">
  
  
  <meta property="og:updated_time" content="2018-12-05T00:00:00Z">
  
    
    
    
    <meta property="article:tag" content="GdalUtils">
    <meta property="article:tag" content="raster">
    <meta property="article:tag" content="furrr">
    <meta property="article:tag" content="plotly">
    <meta property="article:tag" content="rasterVIS">
    
    
    <meta property="article:published_time" content="2018-12-05T00:00:00Z">
    <meta property="article:modified_time" content="2018-12-05T00:00:00Z">
  

  
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@csaybar">
  <meta name="twitter:title" content="Raster resampling in R">
  
  <meta name="twitter:image" content="/img/banners/01_banner_resample.png">
  
  <meta name="twitter:description" content="Site template made by devcows using hugo">
  

</head>


  <body>

    <div id="all">

        <header>

          <div class="navbar-affixed-top" data-spy="affix" data-offset-top="200">

    <div class="navbar navbar-default yamm" role="navigation" id="navbar">

        <div class="container">
            <div class="navbar-header">
                <a class="navbar-brand home" href="/">
                    <img src="/img/logo.svg" alt="Raster resampling in R logo" class="hidden-xs hidden-sm" width="190">
                    <img src="/img/logo-small.svg" alt="Raster resampling in R logo" class="visible-xs visible-sm" width="190">
                    <span class="sr-only">Raster resampling in R - go to homepage</span>
                </a>
                <div class="navbar-buttons">
                    <button type="button" class="navbar-toggle btn-template-main" data-toggle="collapse" data-target="#navigation">
                      <span class="sr-only">Toggle Navigation</span>
                        <i class="fas fa-align-justify"></i>
                    </button>
                </div>
            </div>
            

            <div class="navbar-collapse collapse" id="navigation">
                <ul class="nav navbar-nav navbar-right">
                  
                  
                  
                  <li class="dropdown">
                    
                    <a href="/">Home</a>
                    
                  </li>
                  
                  
                  <li class="dropdown">
                    
                    <a href="/research/">research</a>
                    
                  </li>
                  
                  
                  <li class="dropdown">
                    
                    <a href="/software/">software</a>
                    
                  </li>
                  
                  
                  <li class="dropdown">
                    
                    <a href="/publications/">publications</a>
                    
                  </li>
                  
                  
                  <li class="dropdown">
                    
                    <a href="/teaching/">teaching</a>
                    
                  </li>
                  
                  
                  <li class="dropdown active">
                    
                    <a href="/blog/">Blog</a>
                    
                  </li>
                  
                  
                  <li class="dropdown">
                    
                    <a href="/contact/">Contact</a>
                    
                  </li>
                  
                </ul>
            </div>
            

            <div class="collapse clearfix" id="search">

                <form class="navbar-form" role="search">
                    <div class="input-group">
                        <input type="text" class="form-control" placeholder="Search">
                        <span class="input-group-btn">

                    <button type="submit" class="btn btn-template-main"><i class="fas fa-search"></i></button>

                </span>
                    </div>
                </form>

            </div>
            

        </div>
    </div>
    

</div>




        </header>

        <div id="heading-breadcrumbs">
    <div class="container">
        <div class="row">
            <div class="col-md-12">
                <h1>Raster resampling in R</h1>
            </div>
        </div>
    </div>
</div>


        <div id="content">
            <div class="container">

                <div class="row">

                    

                    <div class="col-md-9" id="blog-post">

                        <p class="text-muted text-uppercase mb-small text-right">By <a href="#">Cesar Aybar</a> | 2018-12-05</p>

                        <div id="post-content">
                          
<script src="/rmarkdown-libs/htmlwidgets/htmlwidgets.js"></script>
<script src="/rmarkdown-libs/jquery/jquery.min.js"></script>
<link href="/rmarkdown-libs/leaflet/leaflet.css" rel="stylesheet" />
<script src="/rmarkdown-libs/leaflet/leaflet.js"></script>
<link href="/rmarkdown-libs/leafletfix/leafletfix.css" rel="stylesheet" />
<script src="/rmarkdown-libs/Proj4Leaflet/proj4-compressed.js"></script>
<script src="/rmarkdown-libs/Proj4Leaflet/proj4leaflet.js"></script>
<link href="/rmarkdown-libs/rstudio_leaflet/rstudio_leaflet.css" rel="stylesheet" />
<script src="/rmarkdown-libs/leaflet-binding/leaflet.js"></script>
<script src="/rmarkdown-libs/leaflet-providers/leaflet-providers.js"></script>
<script src="/rmarkdown-libs/leaflet-providers-plugin/leaflet-providers-plugin.js"></script>
<script src="/rmarkdown-libs/mapPane/map-pane.js"></script>
<link href="/rmarkdown-libs/HomeButton/home-button.css" rel="stylesheet" />
<script src="/rmarkdown-libs/HomeButton/home-button.js"></script>
<script src="/rmarkdown-libs/HomeButton/easy-button-src.min.js"></script>
<link href="/rmarkdown-libs/PopupTable/popup.css" rel="stylesheet" />
<script src="/rmarkdown-libs/kePrint/kePrint.js"></script>
<script src="/rmarkdown-libs/plotly-binding/plotly.js"></script>
<script src="/rmarkdown-libs/typedarray/typedarray.min.js"></script>
<link href="/rmarkdown-libs/crosstalk/css/crosstalk.css" rel="stylesheet" />
<script src="/rmarkdown-libs/crosstalk/js/crosstalk.min.js"></script>
<link href="/rmarkdown-libs/plotly-htmlwidgets-css/plotly-htmlwidgets.css" rel="stylesheet" />
<script src="/rmarkdown-libs/plotly-main/plotly-latest.min.js"></script>


<div id="introduction" class="section level2">
<h2>1. Introduction</h2>
<p>A typical workflow for earth analysts always will have to do with several spatial data sources (e.g.Â Sentinel, MODIS and Landsat) each one with a particular extent and pixel resolution. <strong>Resampling</strong> is the technique used to <em>homogenize</em> these spatial attributes.</p>
<div class="figure">
<img src="http://desktop.arcgis.com/en/arcmap/latest/extensions/spatial-analyst/performing-analysis/GUID-F4B313D5-9585-4687-B5EE-37E9C9243EBE-web.png" alt="Image obtained from here" />
<p class="caption">Image obtained from <a href="http://desktop.arcgis.com/en/arcmap/latest/extensions/spatial-analyst/performing-analysis/cell-size-and-resampling-in-analysis.htm">here</a></p>
</div>
<p>This post demonstrates how <strong>easy</strong> and <strong>incredibly</strong> fast is resampling gridded data in R using either the <a href="https://cran.r-project.org/web/packages/raster/index.html">raster</a>
and <a href="https://cran.r-project.org/web/packages/gdalUtils/index.html">gdalUtils</a> packages. If you do not familiarize with they , first, look at this <a href="https://geoscripting-wur.github.io/IntroToRaster/">tutorial</a> or run in R:</p>
<pre class="r"><code>vignette(&quot;Raster&quot;, package = &quot;raster&quot;) # Run me in R!</code></pre>
<p>While it is true that the <code>raster</code> âhigh-levelâ functions allow performing fast operation thanks to optimized back-end C code, some gridded manipulation techniques such as <code>raster::resample()</code> can become incredibly slow as the raster size increase. An effective alternative but a little more complicated to code is use a <strong>wrapper library</strong> (gdalUtils).</p>
</div>
<div id="wrapper-libraries" class="section level2">
<h2>2. Wrapper libraries</h2>
<p>In few words, a <em>wrapper</em> library (not confuse with a binding library) is a piece of code which translate a libraryâs existing (e.g GDAL) into a different interface (e.g an R package). The main advantage is that you will use GDAL in its original language (C++). Check it <a href="https://stackoverflow.com/questions/8628326/what-is-the-difference-between-a-wrapper-bindings-and-a-port">this</a> for a more comprehensible explanation.</p>
</div>
<div id="example" class="section level2">
<h2>3. Example</h2>
<p>Get the climatological gridded rainfall dataset <a href="http://ons.snirh.gob.pe/Peru/maproom/Monitoring/Meteorological/PISCO-Prec-v20.pdf">PISCOpclim</a> (~10 km) for <a href="https://en.wikipedia.org/wiki/Arequipa_Region">Arequipa</a> and
measure running time when changing progressively the pixel size.</p>
<div id="libraries" class="section level3">
<h3>3.1 Libraries</h3>
<p>Before coding do not forget install and load the following packages.</p>
<p>#####Data Visualization libraries</p>
<pre class="r"><code>library(&#39;ggplot2&#39;)
library(&#39;plotly&#39;)
library(&#39;cptcity&#39;)
library(&#39;rasterVis&#39;)
library(&#39;mapview&#39;)
library(&#39;kableExtra&#39;)</code></pre>
<p>#####R as a GIS</p>
<pre class="r"><code>library(&#39;gdalUtils&#39;)
library(&#39;sf&#39;)
library(&#39;raster&#39;)</code></pre>
<p>#####Functional programming and tidyverse</p>
<pre class="r"><code>library(&#39;purrr&#39;)
library(&#39;furrr&#39;)
library(&#39;tidyverse&#39;)</code></pre>
</div>
<div id="downloadingstacking-piscopclim" class="section level3">
<h3>3.2 Downloading/Stacking PISCOpclim</h3>
<pre class="r"><code>user &lt;- &#39;publi_dgh2&#39; # ftp user 
pass &lt;- &#39;123456&#39;   # ftp user
ftp &lt;- &#39;ftp.senamhi.gob.pe/PISCOp_V2.1_beta/&#39; # url
dir &lt;- &#39;PISCOp_climatology/PISCOp_climatology/&#39; # urn
months &lt;- sprintf(&#39;%02d&#39;, 1:12) # GEOtiff names

clim &lt;- sprintf(&#39;ftp://%s:%s@%s%s%s.tif&#39;, user, pass, ftp, dir, months)

td &lt;- tempdir() #temporal dir
tmp_files &lt;- sprintf(&#39;%s%s&#39;, td, basename(clim))

ftp_n &lt;- mapply(download.file, clim, tmp_files, quiet = TRUE)

clim_stack &lt;- stack(tmp_files) %&gt;% 
  &#39;names&lt;-&#39;(month.abb) %&gt;% &#39;*&#39;(1) # change the RasterLayer names
clim_stack[clim_stack &lt;= 0] &lt;- 0
storage.mode(clim_stack[]) = &quot;integer&quot; #round to an integer

mapply(file.remove, tmp_files)</code></pre>
</div>
<div id="downloadinguncompressing-geometries" class="section level3">
<h3>3.2 Downloading/Uncompressing geometries</h3>
<pre class="r"><code>webpage_github &lt;- &#39;https://github.com/csaybar/csaybar.github.io/&#39;
file &lt;- &#39;raw/master/data/post01.zip&#39;
link &lt;- sprintf(&#39;%s%s&#39;, webpage_github, file)
fn &lt;- sprintf(&#39;%s.zip&#39;, tempfile())
download.file(link, fn)
td &lt;- tempdir()
unzip(fn, ex = td)</code></pre>
</div>
<div id="visualizing-piscopclim" class="section level3">
<h3>3.3 Visualizing PISCOpclim</h3>
<pre class="r"><code>name_sud &lt;- sprintf(&#39;%s/sud_peru_2.shp&#39;, td)
sud_sp &lt;- st_read(name_sud, quiet = TRUE) %&gt;% as(&#39;Spatial&#39;)

palette &lt;- cpt(&#39;ukmo_wow_humidity&#39;) 
range &lt;- seq(0,800,100)
levelplot(clim_stack,
          main = &#39;PISCOp Climatological Precipitation&#39;, 
          margin = T,    
          colorkey = list(
            labels = list(at = range, font = 4),
            axis.line = list(col = &#39;black&#39;)),    
          col.regions = palette,
          at = range) +
  layer(sp.polygons(sud_sp, col = rgb(1, 1, 1, 0.4), lwd = 1))</code></pre>
<p><img src="/blog/resample_files/figure-html/img_01-1.png" width="672" /></p>
</div>
<div id="arequipa-region" class="section level3">
<h3>3.4 Arequipa Region</h3>
<pre class="r"><code># Creating a polygon of the PISCOp extent
piscop_extent &lt;- clim_stack[[1]] %&gt;% 
                  extent %&gt;% 
                  raster(nrows = 1, ncols = 1) %&gt;% 
                  as(&#39;SpatialPolygons&#39;) %&gt;% 
                  st_as_sf()

piscop_extent$NOMBRE = &#39;PISCOp extent&#39;

name_arq &lt;- sprintf(&#39;%s/arequipa_simply.shp&#39;, td)
arequipa &lt;- st_read(name_arq, quiet = TRUE) %&gt;% as(&#39;Spatial&#39;)

m_01 &lt;- mapview(arequipa)
m_02 &lt;- mapview(piscop_extent, fill = NA)

m_01 + m_02</code></pre>
<div id="htmlwidget-1" style="width:672px;height:480px;" class="leaflet html-widget"></div>
<script type="application/json" data-for="htmlwidget-1">{"x":{"options":{"minZoom":1,"maxZoom":100,"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}},"preferCanvas":false,"bounceAtZoomLimits":false,"maxBounds":[[[-90,-370]],[[90,370]]]},"calls":[{"method":"addProviderTiles","args":["CartoDB.Positron",1,"CartoDB.Positron",{"errorTileUrl":"","noWrap":false,"detectRetina":false}]},{"method":"addProviderTiles","args":["CartoDB.DarkMatter",2,"CartoDB.DarkMatter",{"errorTileUrl":"","noWrap":false,"detectRetina":false}]},{"method":"addProviderTiles","args":["OpenStreetMap",3,"OpenStreetMap",{"errorTileUrl":"","noWrap":false,"detectRetina":false}]},{"method":"addProviderTiles","args":["Esri.WorldImagery",4,"Esri.WorldImagery",{"errorTileUrl":"","noWrap":false,"detectRetina":false}]},{"method":"addProviderTiles","args":["OpenTopoMap",5,"OpenTopoMap",{"errorTileUrl":"","noWrap":false,"detectRetina":false}]},{"method":"createMapPane","args":["polygon",420]},{"method":"addPolygons","args":[[[[{"lng":[-75.0750862783773,-75.0478671533519,-75.0289160283343,-75.0169531533231,-75.0165566533228,-74.9682011532777,-74.9636386532735,-74.9293066532415,-74.8752050281911,-74.855744153173,-74.8217539031413,-74.7627480280864,-74.7386484030639,-74.7218164030483,-74.7133399030403,-74.6789862780084,-74.6504980279818,-74.628181652961,-74.6049726529394,-74.5533222778913,-74.5128105278536,-74.5034570278449,-74.4667519028107,-74.4229882777699,-74.40155077775,-74.3899237777391,-74.4002987777488,-74.3913730277405,-74.3953867777442,-74.3878789027372,-74.4150996527626,-74.3770059027271,-74.346755902699,-74.3320702776853,-74.3088066526636,-74.3298027776832,-74.3196484026737,-74.3039550276591,-74.3117226526663,-74.3013086526566,-74.2648612776227,-74.232955027593,-74.1944961525572,-74.166472652531,-74.1547774025202,-74.1498027775155,-74.1375430275041,-74.1316230274986,-74.1151425274832,-74.0957344024652,-74.0647050274363,-74.037589902411,-74.0430292774161,-74.0728906524439,-74.0778496524485,-74.066589902438,-74.0756601524465,-74.0841836524544,-74.0639042774355,-74.0189824023937,-74.0100019023853,-73.9696737773478,-73.9446250273244,-73.9127421522948,-73.8761601522607,-73.8689355272539,-73.8769004022614,-73.8714824022563,-73.884033152268,-73.8661952772514,-73.806777402196,-73.7933359021835,-73.7752695271667,-73.7796250271708,-73.7582011521508,-73.6887441520861,-73.6538320270536,-73.6128612770155,-73.594130901998,-73.5545586519612,-73.5297851519381,-73.4778437768897,-73.4411094018555,-73.4270546518424,-73.4305351518456,-73.4168476518329,-73.3919609018097,-73.3660956517856,-73.3369590267585,-73.275162151701,-73.2939765267185,-73.2908945267156,-73.2779472767035,-73.2844844017096,-73.2482226516759,-73.172134776605,-73.1529550265871,-73.1498945265843,-73.120582026557,-73.1110996515482,-73.1006465265384,-73.0597617765004,-73.0474024014888,-73.0474160264889,-73.0202187764635,-73.0242305264672,-73.0042421514486,-73.0051112764494,-72.9827421514286,-72.9866562764323,-73.0318535264744,-73.0038222764483,-73.0027851514473,-72.9931250264383,-72.9795917764257,-72.9299004013794,-72.886498026339,-72.8726347763261,-72.8459394013012,-72.8294902762859,-72.7901152762492,-72.7704081512309,-72.7413399012038,-72.7263027761898,-72.724418026188,-72.6992636511646,-72.6913456511572,-72.6488184011176,-72.6122362760836,-72.5993125260715,-72.6023184010743,-72.5943750260669,-72.5703125260445,-72.4752206509559,-72.4606327759424,-72.4707187759518,-72.4869160259668,-72.4868476509668,-72.4689180259501,-72.4684296509496,-72.4595566509414,-72.4345702759181,-72.4196094009042,-72.4167167759014,-72.3167187758083,-72.2536094007496,-72.2415781507383,-72.2211524007193,-72.2125781507114,-72.1893242756897,-72.1596680256621,-72.1457441506491,-72.1329980256372,-72.1335254006377,-72.0903555255975,-72.0761191505842,-72.0627441505718,-72.0439140255543,-72.0405117755511,-72.0251992755368,-72.0401465255508,-72.0342324005452,-72.0409237755515,-72.0364921505474,-72.0476309005577,-72.0402597755509,-72.024314400536,-72.0102930255229,-71.9886484005028,-71.9735644004888,-71.9311757754493,-71.9518965254686,-71.9461445254632,-71.9587246504749,-71.9324726504505,-71.9250879004436,-71.8934180254141,-71.8742362753962,-71.868636775391,-71.8549726503783,-71.8634180253862,-71.8596035253826,-71.8284296503536,-71.8238906503493,-71.7937461503213,-71.7677539002971,-71.7499004002804,-71.7486425252793,-71.7700800252992,-71.7651211502946,-71.849236275373,-71.8365859003612,-71.8163066503423,-71.8019101503289,-71.7581484002881,-71.7410820252722,-71.7126699002458,-71.6737070252095,-71.6425331501804,-71.6168515251565,-71.58833402513,-71.5843437751263,-71.568007775111,-71.5129160250597,-71.4848320250336,-71.4846035250334,-71.5043340250517,-71.5103066500573,-71.5065917750538,-71.4671562750171,-71.4564824000072,-71.4476386499989,-71.4446562749962,-71.4270468999798,-71.4297265249822,-71.4213476499745,-71.4162441499697,-71.3985058999532,-71.3711327749277,-71.361847649919,-71.3539726499117,-71.3291698998886,-71.3224492748824,-71.3103945248711,-71.2625507748266,-71.2655410248294,-71.2437753998091,-71.226554649793,-71.2153925247826,-71.207154274775,-71.2080996497758,-71.195357399764,-71.1647871497355,-71.143837899716,-71.1850351497544,-71.1576757747289,-71.2029648997711,-71.1963046497649,-71.164238274735,-71.1637871497346,-71.1532285247247,-71.1525487747241,-71.171798774742,-71.1742773997443,-71.1520312747236,-71.1200937746939,-71.1038358996788,-71.0861816496623,-71.0720448996491,-71.0754550246523,-71.0463027746252,-71.0389706496183,-71.0274277746076,-70.9949042745773,-70.9954687745778,-71.0183632745992,-71.0080331495895,-71.0183555245991,-71.0071952745888,-71.0081796495897,-70.9823691495656,-70.9391640245254,-70.9239961495113,-70.9163437745041,-70.9177851495055,-70.8996972744886,-70.9050605244936,-70.9224921495098,-70.9320898995188,-70.9422675245283,-70.8898691494795,-70.8965605244857,-70.8909765244805,-70.8847500244747,-70.8671640244583,-70.8430487744359,-70.8331230244266,-70.8424980244353,-70.8208320244152,-70.8289726494228,-70.8165586494112,-70.8209452744153,-70.8040840243996,-70.8565371494484,-70.865783149457,-70.8778300244683,-70.8750605244657,-70.8954081494846,-70.8676992744588,-70.8677753994589,-70.878593774469,-70.8585351494503,-70.853888649446,-70.8669961494582,-70.8444511494372,-70.8765331494671,-70.9155663995034,-70.9389413995252,-70.9437636495297,-70.9863593995694,-70.9693535245535,-70.9747246495585,-70.9639355245484,-70.9755468995593,-70.953781274539,-70.9566718995417,-70.9804003995638,-70.9940038995765,-71.0132987745944,-71.0189355245997,-71.037552774617,-71.0478281496266,-71.0725702746496,-71.0812910246578,-71.1101836496847,-71.1251230246986,-71.1401680247126,-71.242652399808,-71.2493437748143,-71.2375937748033,-71.2480468998131,-71.2628398998268,-71.2604375248246,-71.2775195248405,-71.284447274847,-71.2988125248603,-71.2969355248586,-71.2861855248486,-71.2890937748513,-71.3269042748865,-71.3673867749242,-71.4254375249783,-71.4285956499812,-71.4441913999957,-71.4352577749874,-71.4403612749922,-71.4223027749753,-71.4246972749776,-71.4424062749941,-71.4559472750067,-71.4655371500156,-71.4568027750075,-71.402626899957,-71.3919296499471,-71.3947148999497,-71.3858573999414,-71.3658456499228,-71.3577948999153,-71.3405996498992,-71.3203730248804,-71.3258125248855,-71.304908149866,-71.3159101498763,-71.3515781499095,-71.4235077749765,-71.4422461499939,-71.4683300250182,-71.496018275044,-71.5093125250564,-71.5240682750701,-71.5286726500744,-71.537916775083,-71.5640149001073,-71.673215150209,-71.829944775355,-71.868607400391,-71.9302105254484,-72.0164114005287,-72.0231131505349,-72.041490025552,-72.0735721505819,-72.0911021505982,-72.1122032756179,-72.10380665061,-72.1225007756275,-72.1192929006245,-72.1438486506473,-72.1459817756493,-72.1651389006672,-72.164947150667,-72.184321650685,-72.1844182756851,-72.1956825256956,-72.2115210257104,-72.2276005257253,-72.2325235257299,-72.2764784007709,-72.288484525782,-72.2872890257809,-72.2968339007898,-72.2887042757822,-72.312045525804,-72.3101170258022,-72.3264740258174,-72.3290817758198,-72.3541134008431,-72.3742607758619,-72.3731222758609,-72.4006917758865,-72.4053086508908,-72.4166090259014,-72.4478766509305,-72.5936665260663,-72.7090439011737,-72.7519951512137,-72.9200904013703,-72.9868476514324,-73.0041299014485,-73.0116991514556,-73.0487705264901,-73.0554880264964,-73.103395026541,-73.1290590265649,-73.1485835265831,-73.1591577765929,-73.189348026621,-73.2084427766388,-73.2350100266636,-73.2435720266715,-73.2603944016872,-73.2603604016872,-73.2722091516982,-73.2915132767162,-73.3059300267296,-73.3007700267248,-73.3142010267373,-73.451255901865,-73.4821901518938,-73.5593292769656,-73.5674071519731,-73.619927777022,-73.6491724020493,-73.6762097770745,-73.7003217770969,-73.6997045270963,-73.7278845271226,-73.8345049022219,-73.870120777255,-73.8873396522711,-73.9530262773323,-73.9591155273379,-73.9794081523568,-73.9896226523663,-74.0181301523929,-74.0331725274069,-74.0255982773998,-74.0544496524267,-74.175034152539,-74.241603152601,-74.2526784026113,-74.2790065276359,-74.2917794026478,-74.3044001526595,-74.3132195276677,-74.3267339026803,-74.3267994026804,-74.3954770277443,-74.439120777785,-74.462734777807,-74.4628436528071,-74.472457277816,-74.6802937780096,-74.7285075280545,-74.8033299031242,-74.8394919031578,-74.8534056531708,-74.8477520281655,-74.8875534032026,-74.9736224032828,-74.9845444032929,-75.0005125283078,-75.0445727783489,-75.0750862783773],"lat":[-15.4429585409889,-15.4330292909796,-15.4042792909528,-15.3772344159276,-15.3510956659033,-15.2994219158552,-15.2538984158128,-15.1924022907555,-15.1519472907178,-15.1535859157194,-15.1412831657079,-15.0990625406686,-15.1225429156904,-15.1238827906917,-15.1383612907052,-15.1321171656994,-15.138171915705,-15.1250956656928,-15.1484277907145,-15.140275415707,-15.1488397907149,-15.1612675407265,-15.1737011657381,-15.1678476657326,-15.1785234157426,-15.203669915766,-15.2203730407816,-15.2253222907862,-15.2403300408001,-15.2517792908108,-15.2996484158554,-15.3317890408853,-15.3359609158892,-15.353980415906,-15.3600917909117,-15.3935254159428,-15.4385097909847,-15.4524101659977,-15.4633730410079,-15.478511666022,-15.4741445410179,-15.4873164160302,-15.491459041034,-15.483957041027,-15.4631425410077,-15.4272070409742,-15.4265644159736,-15.414156290962,-15.4120429159601,-15.3922129159416,-15.4030996659517,-15.4549941660001,-15.4917969160343,-15.5017500410436,-15.515027291056,-15.5394062910787,-15.55154291609,-15.6188847911527,-15.6293397911624,-15.5996875411348,-15.5596386660975,-15.5332206660729,-15.4884882910313,-15.4566054160016,-15.4375937909839,-15.4214531659688,-15.3889550409386,-15.3799296659301,-15.3375625408907,-15.3236816658778,-15.3245215408785,-15.3398652908928,-15.3389160408919,-15.3463437908989,-15.3863827909362,-15.4376581659839,-15.4176230409653,-15.4192285409668,-15.404423790953,-15.4070879159555,-15.3918906659413,-15.3794980409297,-15.3557577909076,-15.3633417909147,-15.3792050409295,-15.3762480409267,-15.3994609159483,-15.3875820409373,-15.4049199159534,-15.3932382909425,-15.3587480409104,-15.334625040888,-15.3169570408715,-15.2945312908506,-15.2862382908429,-15.3060761658614,-15.2830644158399,-15.2597460408182,-15.2308164157913,-15.1861269157497,-15.1870781657505,-15.14357416571,-15.1412402907079,-15.1337715407009,-15.1268397906944,-15.0913340406614,-15.0641269156361,-15.0077500405835,-14.9823554155599,-14.9561035405354,-14.8971230404805,-14.8395840404269,-14.814986290404,-14.8038827903937,-14.8062304153958,-14.7583359153512,-14.7723202903643,-14.7623066653549,-14.7598769153527,-14.7025487902993,-14.6505702902509,-14.6647129152641,-14.6443202902451,-14.6440605402448,-14.6767031652752,-14.6788456652772,-14.6889491652866,-14.6679511652671,-14.6764081652749,-14.6901112902877,-14.7025840402993,-14.7136757903097,-14.6827362902808,-14.6586796652584,-14.6762500402748,-14.7053261653019,-14.7142070403102,-14.7413710403355,-14.7612070403539,-14.7873184153783,-14.782750040374,-14.7901386653809,-14.8063164153959,-14.8228340404113,-14.8347362904224,-14.8033125403931,-14.8124941654017,-14.8002265403903,-14.8034472903933,-14.7782362903698,-14.7863417903773,-14.777417915369,-14.78924604038,-14.8262206654145,-14.8567362904429,-14.8842851654686,-14.8878906654719,-14.8827167904671,-14.8401054154274,-14.8297949154178,-14.8109277904002,-14.8025019153924,-14.7793789153708,-14.7673612903596,-14.7384647903328,-14.6880469152858,-14.6734296652722,-14.6427969152437,-14.6328066652343,-14.6579902902578,-14.6894590402871,-14.7044570403011,-14.7117636653079,-14.7326581653273,-14.7575000403505,-14.7893632903802,-14.7885331653794,-14.8062147903958,-14.8357382904233,-14.8545800404409,-14.8733554154584,-14.8836152904679,-14.8882147904722,-14.90736129049,-14.8972304154806,-14.9280059155093,-14.9365272905172,-14.9477011655276,-14.9797559155575,-15.0079452905837,-15.0441445406174,-15.0756934156468,-15.078078165649,-15.0670976656388,-15.0856542906561,-15.0801269156509,-15.08984179066,-15.0890546656593,-15.1334941657007,-15.1455761657119,-15.1278241656954,-15.0964570406661,-15.0658261656376,-15.080138665651,-15.0568906656293,-15.0393261656129,-15.0261269156007,-15.0065059155824,-14.9758125405538,-14.9833007905608,-14.9772362905551,-14.9801894155579,-14.9948730405715,-15.0015840405778,-15.0095546655852,-15.012556665588,-15.0336855406077,-15.0428144156162,-15.0805644156513,-15.07914254065,-15.0924765406624,-15.0992324156687,-15.1186816656868,-15.1186699156868,-15.0773906656484,-15.063000040635,-15.0562460406287,-15.0700429156416,-15.0488886656219,-15.0506562906235,-15.0690487906406,-15.0904746656606,-15.0976640406673,-15.1269219156945,-15.1701230407348,-15.2038612907662,-15.2457265408052,-15.2695976658274,-15.2909277908473,-15.3300644158837,-15.3412382908941,-15.3638397909152,-15.3882500409379,-15.4247206659719,-15.4408085409869,-15.4271035409741,-15.4532695409985,-15.4586601660035,-15.4507226659961,-15.4383007909845,-15.420523415968,-15.4051660409536,-15.432347665979,-15.4541094159992,-15.4725781660164,-15.500021541042,-15.5192402910599,-15.5293789160693,-15.542949166082,-15.5639687911016,-15.5980429161333,-15.6180234161519,-15.6329960411658,-15.6521991661837,-15.6875487912166,-15.7132695412406,-15.7370292912627,-15.745960916271,-15.7689237912924,-15.774923791298,-15.851150416369,-15.8769921663931,-15.8879257914033,-15.8935625414085,-15.8895429164048,-15.9242675414371,-15.9501972914613,-15.9699434164797,-15.9786054164877,-15.9986386665064,-16.0027539165102,-16.0297500415354,-16.0538281665578,-16.05621679156,-16.0788535415811,-16.0814219165835,-16.0945781665957,-16.1050292916055,-16.1273144166262,-16.1514862916487,-16.1666171666628,-16.1801035416754,-16.1966875416908,-16.224851541717,-16.2342460417258,-16.2809491667693,-16.2822129167705,-16.2992031667863,-16.3144022918004,-16.3098359167962,-16.3702460418525,-16.390119166871,-16.3995976668798,-16.4185879168975,-16.459976541936,-16.4721699169474,-16.4811934169558,-16.4968417919704,-16.4994980419728,-16.4868750419611,-16.4852636669596,-16.4554726669318,-16.4658866669415,-16.4567831669331,-16.4661737919418,-16.4612362919372,-16.47500391695,-16.4626855419386,-16.4823594169569,-16.5028066669759,-16.56084566703,-16.5849121670524,-16.6052441670713,-16.611363292077,-16.6820410421428,-16.6965156671563,-16.7099004171688,-16.7141250421727,-16.7264570421842,-16.7526152922086,-16.7193632921776,-16.7409277921977,-16.7731796672277,-16.8095625422616,-16.8349452922852,-16.8627362923111,-16.8945371673407,-16.9176465423623,-16.9324590423761,-16.9332167923768,-16.9537402923959,-16.9606054174023,-16.9577890423997,-16.9768164174174,-16.9931289174326,-17.0201484174577,-17.0138359174518,-17.0241250424614,-17.0212519174588,-17.0400175424762,-17.0563965424915,-17.0984237925306,-17.1232539175538,-17.1480234175768,-17.2365800426593,-17.2509414176727,-17.2568574176782,-17.2849386677043,-17.2686087926891,-17.2653262926861,-17.2711305426915,-17.2539566676755,-17.2615674176826,-17.2173677926414,-17.1766976676035,-17.149279042578,-17.0806849175141,-17.0328682924696,-17.0223934174598,-17.0158761674537,-17.0223640424598,-17.01189541745,-17.0157581674536,-16.9962606674355,-16.9781742924186,-16.9699262924109,-16.9657882924071,-16.9565317923985,-16.9481784173907,-16.9381087923813,-16.9357502923791,-16.9247840423689,-16.9268019173708,-16.9024466673481,-16.8943271673405,-16.9005515423463,-16.8730952923208,-16.8751322923227,-16.8605919173091,-16.8490325422984,-16.8370245422872,-16.8137777922655,-16.8076186672598,-16.8028510422554,-16.7892146672426,-16.765957167221,-16.7607525422161,-16.7524890422085,-16.7511107922072,-16.7389406671958,-16.7361617921932,-16.7023819171618,-16.6673284171291,-16.6526935421155,-16.6381159171019,-16.5184871669905,-16.5174354169895,-16.5070324169799,-16.5123602919848,-16.4999445419732,-16.4871209169613,-16.4548165419312,-16.4510774169277,-16.4388097919163,-16.4199259168987,-16.4153990418945,-16.4003921668805,-16.4152765418944,-16.4067929168865,-16.4092782918888,-16.401981416882,-16.3982021668785,-16.4057751668855,-16.3752722918571,-16.3520636668355,-16.3387030418231,-16.2813075417696,-16.2836897917718,-16.2444934167353,-16.24954116674,-16.2300857917219,-16.2342892917258,-16.2235587917158,-16.2415547917326,-16.2199399167125,-16.1952472916895,-16.1547345416517,-16.1349082916333,-16.1104942916106,-16.0751087915776,-16.0608162915643,-16.052958791557,-16.0391144165441,-16.0366262915418,-16.017573916524,-15.9925170415007,-15.9545217914653,-15.8969779164117,-15.8786997913947,-15.8542302913719,-15.8388184163575,-15.8370102913558,-15.8464954163647,-15.8398991663585,-15.8497310413677,-15.8420426663605,-15.8293566663487,-15.7949114163166,-15.7554292912799,-15.7260945412526,-15.7194845412464,-15.6451241661771,-15.611685291146,-15.5768391661135,-15.5650857911026,-15.5732119161102,-15.5545396660928,-15.5241269160644,-15.4905747910332,-15.4701936660142,-15.4621192910067,-15.4584757910033,-15.4429585409889]}]]],null,"arequipa",{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}},"pane":"polygon","stroke":true,"color":"#333333","weight":1,"opacity":0.9,"fill":true,"fillColor":"#6666FF","fillOpacity":0.6,"smoothFactor":1,"noClip":false},["<html><head><link rel=\"stylesheet\" type=\"text/css\" href=\"lib/popup/popup.css\"><\/head><body><div class=\"scrollableContainer\"><table class=\"popup scrollable\"><table id=\"popup\"><tr class='coord'><td><\/td><td><b>Feature ID<\/b><\/td><td align='right'>1&emsp;<\/td><\/tr><tr class='alt'><td>1<\/td><td><b>NOMBRE&emsp;<\/b><\/td><td align='right'>AREQUIPA&emsp;<\/td><\/tr><tr><td>2<\/td><td><b>geometry&emsp;<\/b><\/td><td align='right'>sfc_POLYGON&emsp;<\/td><\/tr><\/table><\/body><\/html>"],{"maxWidth":800,"minWidth":50,"autoPan":true,"keepInView":false,"closeButton":true,"closeOnClick":true,"className":""},"AREQUIPA",{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},{"stroke":true,"weight":2,"opacity":0.9,"fillOpacity":0.84,"bringToFront":false,"sendToBack":false}]},{"method":"addScaleBar","args":[{"maxWidth":100,"metric":true,"imperial":true,"updateWhenIdle":true,"position":"bottomleft"}]},{"method":"addHomeButton","args":[-75.0750862783773,-17.2849386677043,-70.8040840243996,-14.6328066652343,"Zoom to arequipa","<strong> arequipa <\/strong>","bottomright"]},{"method":"addPolygons","args":[[[[{"lng":[-81.3,-68,-68,-81.3,-81.3],"lat":[1,1,-18.8,-18.8,1]}]]],null,"piscop_extent",{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}},"pane":"polygon","stroke":true,"color":"#333333","weight":1,"opacity":0.9,"fill":null,"fillColor":"#6666FF","fillOpacity":0.6,"smoothFactor":1,"noClip":false},["<html><head><link rel=\"stylesheet\" type=\"text/css\" href=\"lib/popup/popup.css\"><\/head><body><div class=\"scrollableContainer\"><table class=\"popup scrollable\"><table id=\"popup\"><tr class='coord'><td><\/td><td><b>Feature ID<\/b><\/td><td align='right'>1&emsp;<\/td><\/tr><tr class='alt'><td>1<\/td><td><b>geometry&emsp;<\/b><\/td><td align='right'>sfc_POLYGON&emsp;<\/td><\/tr><tr><td>2<\/td><td><b>NOMBRE&emsp;<\/b><\/td><td align='right'>PISCOp extent&emsp;<\/td><\/tr><\/table><\/body><\/html>"],{"maxWidth":800,"minWidth":50,"autoPan":true,"keepInView":false,"closeButton":true,"closeOnClick":true,"className":""},"PISCOp extent",{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},{"stroke":true,"weight":2,"opacity":0.9,"fillOpacity":0.84,"bringToFront":false,"sendToBack":false}]},{"method":"addHomeButton","args":[-81.3,-18.8,-68,1,"Zoom to piscop_extent","<strong> piscop_extent <\/strong>","bottomright"]},{"method":"addLayersControl","args":[["CartoDB.Positron","CartoDB.DarkMatter","OpenStreetMap","Esri.WorldImagery","OpenTopoMap"],["arequipa","piscop_extent"],{"collapsed":true,"autoZIndex":true,"position":"topleft"}]},{"method":"addHomeButton","args":[-81.3,-18.8,-68,1,"Zoom to full extent","<strong>Zoom full<\/strong>","bottomleft"]}],"limits":{"lat":[-17.2849386677043,-14.6328066652343],"lng":[-75.0750862783773,-70.8040840243996]},"fitBounds":[-18.8,-81.3,1,-68,[]]},"evals":[],"jsHooks":{"render":[{"code":"function(el, x, data) {\n  return (\n      function(el, x, data) {\n\n        // get the leaflet map\n        var map = this; //HTMLWidgets.find('#' + el.id);\n\n        // we need a new div element because we have to handle\n        // the mouseover output separately\n        // debugger;\n        function addElement () {\n          // generate new div Element\n         var newDiv = $(document.createElement('div'));\n          // append at end of leaflet htmlwidget container\n          $(el).append(newDiv);\n          //provide ID and style\n          newDiv.addClass('lnlt');\n          newDiv.css({\n            'position': 'relative',\n            'bottomleft':  '0px',\n            'background-color': 'rgba(255, 255, 255, 0.7)',\n            'box-shadow': '0 0 2px #bbb',\n            'background-clip': 'padding-box',\n            'margin': '0',\n            'padding-left': '5px',\n            'color': '#333',\n            'font': '9px/1.5 \"Helvetica Neue\", Arial, Helvetica, sans-serif',\n            'z-index': '700',\n          });\n          return newDiv;\n        }\n\n        // check for already existing lnlt class to not duplicate\n        var lnlt = $(el).find('.lnlt');\n\n        if(!lnlt.length) {\n          lnlt = addElement();\n          //$(el).keypress(function (e) {\n          //  if (e.which == 32 || event.keyCode == 32) {\n          //    alert('space key is pressed');\n          //  }\n          //});\n          // grab the special div we generated in the beginning\n          // and put the mousmove output there\n          map.on('mousemove', function (e) {\n            lnlt.text(\n                           ' x: ' + L.CRS.EPSG3857.project(e.latlng).x.toFixed(0) +\n                           ' | y: ' + L.CRS.EPSG3857.project(e.latlng).y.toFixed(0) +\n                           ' | epsg: 3857 ' +\n                           ' | proj4: +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs ' +\n                           ' | lon: ' + (e.latlng.lng).toFixed(5) +\n                           ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                           ' | zoom: ' + map.getZoom() + ' ');\n          });\n        };\n      }\n      ).call(this.getMap(), el, x, data);\n}","data":null}]}}</script>
</div>
<div id="method-01-resampling-via-raster-package" class="section level3">
<h3>3.5 Method 01: Resampling via <code>raster</code> package</h3>
<pre class="r"><code>raster_base &lt;- crop(clim_stack[[1]], arequipa)
res(raster_base) &lt;- 0.05

clim_1_a &lt;- raster::resample(clim_stack,
                             raster_base,
                             method=&#39;bilinear&#39;)

plot(clim_1_a[[1]], main = &#39;Jan Precipitation in Arequipa&#39;)
plot(arequipa, add = TRUE)</code></pre>
<p><img src="/blog/resample_files/figure-html/img_03-1.png" width="672" /></p>
</div>
<div id="method-02-resampling-via-gdalutils-package" class="section level3">
<h3>3.6 Method 02: Resampling via <code>gdalUtils</code> package</h3>
<pre class="r"><code>#&#39; Resampling a Raster* object via GDAL
#&#39; 
#&#39; @param r Raster* object to be resampled
#&#39; @param r_base Raster* object with parameters that r
#&#39; should be resampled to.
#&#39; @param method Character. GDAL resampling_method
#&#39; (&quot;near&quot;|&quot;bilinear&quot;|&quot;cubic&quot;|&quot;cubicspline&quot;|
#&#39;  &quot;lanczos&quot;|&quot;average&quot;|&quot;mode&quot;|&quot;max&quot;|&quot;min&quot;|
#&#39;  &quot;med&quot;|&quot;q1&quot;|&quot;q3&quot;)
#&#39;
#&#39; @export
gdal_resample &lt;- function(r, r_base, method = &#39;bilinear&#39;) {
  
  #Geometry attributes
  t1 &lt;- c(xmin(r_base), ymin(r_base), 
          xmax(r_base), ymax(r_base))
  res &lt;- res(r_base)
  
  #Temporal files
  tmp_outname &lt;- sprintf(&#39;%s.tif&#39;, tempfile())
  tmp_inname &lt;- sprintf(&#39;%s.tif&#39;, tempfile())
  writeRaster(r, tmp_inname)
  
  #GDAL time!
  gdalwarp(tmp_inname, tmp_outname, 
           tr = res, te = t1, r = method)
  resample_raster = raster(tmp_outname)
  
  return(resample_raster)
}</code></pre>
<p><strong>Sequential approach</strong></p>
<pre class="r"><code>clim_1_b &lt;- names(clim_stack) %&gt;% 
  map(~ gdal_resample(clim_stack[[.x]], raster_base)) %&gt;%
  stack()

plot(clim_1_b[[1]], main = &#39;Jan Precipitation in Arequipa&#39;)
plot(arequipa, add = TRUE)</code></pre>
<p><img src="/blog/resample_files/figure-html/img_04-1.png" width="672" /></p>
<p><strong>Multiprocessing approach</strong></p>
<pre class="r"><code>message(sprintf(&#39;%s \n&#39;,system(&#39;lscpu&#39;,intern = T))) # only valid for linux users</code></pre>
<pre><code>## Architecture:        x86_64 
## CPU op-mode(s):      32-bit, 64-bit 
## Byte Order:          Little Endian 
## Address sizes:       39 bits physical, 48 bits virtual 
## CPU(s):              4 
## On-line CPU(s) list: 0-3 
## Thread(s) per core:  2 
## Core(s) per socket:  2 
## Socket(s):           1 
## NUMA node(s):        1 
## Vendor ID:           GenuineIntel 
## CPU family:          6 
## Model:               60 
## Model name:          Intel(R) Core(TM) i5-4200M CPU @ 2.50GHz 
## Stepping:            3 
## CPU MHz:             2284.079 
## CPU max MHz:         3100.0000 
## CPU min MHz:         800.0000 
## BogoMIPS:            4988.69 
## Virtualization:      VT-x 
## L1d cache:           32K 
## L1i cache:           32K 
## L2 cache:            256K 
## L3 cache:            3072K 
## NUMA node0 CPU(s):   0-3 
## Flags:               fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca cmov pat pse36 clflush dts acpi mmx fxsr sse sse2 ss ht tm pbe syscall nx pdpe1gb rdtscp lm constant_tsc arch_perfmon pebs bts rep_good nopl xtopology nonstop_tsc cpuid aperfmperf pni pclmulqdq dtes64 monitor ds_cpl vmx est tm2 ssse3 sdbg fma cx16 xtpr pdcm pcid sse4_1 sse4_2 movbe popcnt aes xsave avx f16c rdrand lahf_lm abm cpuid_fault epb invpcid_single pti tpr_shadow vnmi flexpriority ept vpid ept_ad fsgsbase tsc_adjust bmi1 avx2 smep bmi2 erms invpcid xsaveopt dtherm ida arat pln pts</code></pre>
<pre class="r"><code>plan(multiprocess)</code></pre>
<pre class="r"><code>clim_1_c &lt;- names(clim_stack) %&gt;% 
  future_map(~ gdal_resample(clim_stack[[.x]], raster_base)) %&gt;%
  stack()

plot(clim_1_c[[1]], main = &#39;Jan Precipitation in Arequipa&#39;)
plot(arequipa, add = TRUE)</code></pre>
<p><img src="/blog/resample_files/figure-html/img_05-1.png" width="672" /></p>
</div>
</div>
<div id="raster-vs-gdalutils-comparison-simple-benckmark" class="section level2">
<h2>4. <code>raster</code> vs <code>gdalUtils</code> Comparison (Simple Benckmark)</h2>
<pre class="r"><code>cell_size &lt;- c(0.05, 0.025, 0.01, 0.005, 0.0025, 0.00175, 0.0015 , 0.001)

for(x in cell_size) { 
  
  raster_base &lt;- crop(clim_stack[[1]], arequipa)
  res(raster_base) &lt;- x

  time_m01 &lt;- system.time(
    clim_1_a &lt;- resample(clim_stack,
                         raster_base,
                         method=&#39;bilinear&#39;))

  time_m02 &lt;- system.time(
    clim_1_b &lt;- names(clim_stack) %&gt;% 
      map(~ gdal_resample(clim_stack[[.x]], raster_base)) %&gt;%
      stack())

  time_m03 &lt;- system.time(
    clim_1_c &lt;- names(clim_stack) %&gt;% 
      future_map(~ gdal_resample(clim_stack[[.x]],
                                 raster_base)) %&gt;%
      stack())
  
  df_size &lt;- data_frame(
    pixel_size = x,
    npixels = ncell(clim_1_a)*12,
    raster = time_m01[3],
    gdalUtils = time_m02[3],
    gdalUtils_4par = time_m03[3]
  )
  if (x == 0.05) {
    df_base &lt;- df_size
  } else {
    df_base &lt;- bind_rows(df_base, df_size)
  }
}</code></pre>
<table class="table table-striped" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;">
pixel_size
</th>
<th style="text-align:right;">
npixels
</th>
<th style="text-align:right;">
raster
</th>
<th style="text-align:right;">
gdalUtils
</th>
<th style="text-align:right;">
gdalUtils_4par
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
0.05000
</td>
<td style="text-align:right;">
55728
</td>
<td style="text-align:right;">
0.149
</td>
<td style="text-align:right;">
6.112
</td>
<td style="text-align:right;">
2.879
</td>
</tr>
<tr>
<td style="text-align:right;">
0.02500
</td>
<td style="text-align:right;">
222912
</td>
<td style="text-align:right;">
0.121
</td>
<td style="text-align:right;">
6.601
</td>
<td style="text-align:right;">
2.980
</td>
</tr>
<tr>
<td style="text-align:right;">
0.01000
</td>
<td style="text-align:right;">
1393200
</td>
<td style="text-align:right;">
0.573
</td>
<td style="text-align:right;">
6.424
</td>
<td style="text-align:right;">
3.018
</td>
</tr>
<tr>
<td style="text-align:right;">
0.00500
</td>
<td style="text-align:right;">
5572800
</td>
<td style="text-align:right;">
2.323
</td>
<td style="text-align:right;">
6.801
</td>
<td style="text-align:right;">
3.181
</td>
</tr>
<tr>
<td style="text-align:right;">
0.00250
</td>
<td style="text-align:right;">
22291200
</td>
<td style="text-align:right;">
6.025
</td>
<td style="text-align:right;">
8.436
</td>
<td style="text-align:right;">
4.517
</td>
</tr>
<tr>
<td style="text-align:right;">
0.00175
</td>
<td style="text-align:right;">
45493812
</td>
<td style="text-align:right;">
11.339
</td>
<td style="text-align:right;">
12.273
</td>
<td style="text-align:right;">
5.421
</td>
</tr>
<tr>
<td style="text-align:right;">
0.00150
</td>
<td style="text-align:right;">
61927200
</td>
<td style="text-align:right;">
15.254
</td>
<td style="text-align:right;">
14.054
</td>
<td style="text-align:right;">
6.242
</td>
</tr>
<tr>
<td style="text-align:right;">
0.00100
</td>
<td style="text-align:right;">
139320000
</td>
<td style="text-align:right;">
39.838
</td>
<td style="text-align:right;">
23.112
</td>
<td style="text-align:right;">
11.093
</td>
</tr>
</tbody>
</table>
</div>
<div id="results" class="section level2">
<h2>5. Results</h2>
<p>The bellow plot shows a considerable improvement when using <strong>gdaltUtils</strong> respect to <strong>raster</strong> package only for cell sizes &lt; 0.005 km. (50M &gt; pixels). <strong>gdalUtils</strong> using a multiprocessing approach (and 4 cores) was able to generate more than <strong>100M of pixels</strong> in less than 12 seg!.</p>
<pre class="r"><code>df_base %&gt;%  plot_ly(x=~npixels) %&gt;% 
  add_trace(y = ~raster, name = &#39;raster&#39;,
            mode = &#39;lines+markers&#39;) %&gt;%
  add_trace(y = ~gdalUtils, name = &#39;GdalUtils&#39;,
            mode = &#39;lines+markers&#39;) %&gt;%
  add_trace(y = ~gdalUtils_4par, name = &#39;GdalUtils_par&#39;,
            mode = &#39;lines+markers&#39;) %&gt;% 
  layout(xaxis = list(type = &quot;log&quot;,title = &#39;nPixels&#39;),
         yaxis = list(title = &#39;time (s)&#39;))</code></pre>
<div id="htmlwidget-2" style="width:672px;height:480px;" class="plotly html-widget"></div>
<script type="application/json" data-for="htmlwidget-2">{"x":{"visdat":{"b1310e45fed":["function () ","plotlyVisDat"]},"cur_data":"b1310e45fed","attrs":{"b1310e45fed":{"x":{},"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"y":{},"name":"raster","mode":"lines+markers","inherit":true},"b1310e45fed.1":{"x":{},"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"y":{},"name":"GdalUtils","mode":"lines+markers","inherit":true},"b1310e45fed.2":{"x":{},"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"y":{},"name":"GdalUtils_par","mode":"lines+markers","inherit":true}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"xaxis":{"domain":[0,1],"automargin":true,"type":"log","title":"nPixels"},"yaxis":{"domain":[0,1],"automargin":true,"title":"time (s)"},"hovermode":"closest","showlegend":true},"source":"A","config":{"showSendToCloud":false},"data":[{"x":[55728,222912,1393200,5572800,22291200,45493812,61927200,139320000],"y":[0.149000000001251,0.120999999999185,0.57300000000032,2.32300000000032,6.02500000000146,11.3389999999999,15.2540000000008,39.8379999999997],"name":"raster","mode":"lines+markers","type":"scatter","marker":{"color":"rgba(31,119,180,1)","line":{"color":"rgba(31,119,180,1)"}},"error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"line":{"color":"rgba(31,119,180,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":[55728,222912,1393200,5572800,22291200,45493812,61927200,139320000],"y":[6.11200000000099,6.60099999999875,6.42399999999907,6.80099999999948,8.43600000000151,12.273000000001,14.0540000000001,23.112000000001],"name":"GdalUtils","mode":"lines+markers","type":"scatter","marker":{"color":"rgba(255,127,14,1)","line":{"color":"rgba(255,127,14,1)"}},"error_y":{"color":"rgba(255,127,14,1)"},"error_x":{"color":"rgba(255,127,14,1)"},"line":{"color":"rgba(255,127,14,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":[55728,222912,1393200,5572800,22291200,45493812,61927200,139320000],"y":[2.87899999999718,2.97999999999956,3.01800000000003,3.18100000000049,4.51699999999983,5.4210000000021,6.24199999999837,11.0929999999971],"name":"GdalUtils_par","mode":"lines+markers","type":"scatter","marker":{"color":"rgba(44,160,44,1)","line":{"color":"rgba(44,160,44,1)"}},"error_y":{"color":"rgba(44,160,44,1)"},"error_x":{"color":"rgba(44,160,44,1)"},"line":{"color":"rgba(44,160,44,1)"},"xaxis":"x","yaxis":"y","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
<div id="epilogue" class="section level2">
<h2>6. Epilogue</h2>
<p>I hope you have enjoyed reading this post. If you are interested in still continuing increasing the speed of your spatial processings maybe you want to run the following in your R console:</p>
<pre class="r"><code>vignette(&quot;functions&quot;, package = &quot;raster&quot;) # Run me in R!
rasterOptions()</code></pre>
<p>Oh, and before I forget. At the near future, the <a href="https://github.com/rspatial/terra?fbclid=IwAR0gEKvR3AxrvtpyxblIe-jXC2RsZg85IhlI2wDHvGYncOozVdWSMncsoEI">terra</a> package will replacement the raster package. The first (alpha) release is expected by January 2019. I promise will make an update of this post after the packageâs release.</p>
</div>

                        </div>
                        
                        
                        <div id="comments">
                            <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "cesaraybar" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
                        </div>
                        

                    </div>
                    

                    

                    

                    <div class="col-md-3">

                        

                        

<div class="panel panel-default sidebar-menu">

    <div class="panel-heading">
      <h3 class="panel-title">Search</h3>
    </div>

    <div class="panel-body">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" role="search">
            <div class="input-group">
                <input type="search" name="q" class="form-control" placeholder="Search">
                <input type="hidden" name="sitesearch" value="/">
                <span class="input-group-btn">
                    <button type="submit" class="btn btn-template-main"><i class="fas fa-search"></i></button>
                </span>
            </div>
        </form>
    </div>
</div>














<div class="panel sidebar-menu">

    <div class="panel-heading">
        <h3 class="panel-title">Tags</h3>
    </div>

    <div class="panel-body">
        <ul class="tag-cloud">
            
            
            <li>
                <a href="/tags/featuretools"><i class="fas fa-tags"></i> featuretools</a>
            </li>
            
            <li>
                <a href="/tags/folium"><i class="fas fa-tags"></i> folium</a>
            </li>
            
            <li>
                <a href="/tags/furrr"><i class="fas fa-tags"></i> furrr</a>
            </li>
            
            <li>
                <a href="/tags/gdalutils"><i class="fas fa-tags"></i> gdalutils</a>
            </li>
            
            <li>
                <a href="/tags/gee"><i class="fas fa-tags"></i> gee</a>
            </li>
            
            <li>
                <a href="/tags/google-earth-engine"><i class="fas fa-tags"></i> google-earth-engine</a>
            </li>
            
            <li>
                <a href="/tags/keras"><i class="fas fa-tags"></i> keras</a>
            </li>
            
            <li>
                <a href="/tags/lightgbm"><i class="fas fa-tags"></i> lightgbm</a>
            </li>
            
            <li>
                <a href="/tags/plotly"><i class="fas fa-tags"></i> plotly</a>
            </li>
            
            <li>
                <a href="/tags/python"><i class="fas fa-tags"></i> python</a>
            </li>
            
            <li>
                <a href="/tags/raster"><i class="fas fa-tags"></i> raster</a>
            </li>
            
            <li>
                <a href="/tags/rastervis"><i class="fas fa-tags"></i> rastervis</a>
            </li>
            
            <li>
                <a href="/tags/rnaturalearth"><i class="fas fa-tags"></i> rnaturalearth</a>
            </li>
            
            <li>
                <a href="/tags/shap"><i class="fas fa-tags"></i> shap</a>
            </li>
            
            <li>
                <a href="/tags/sklearn"><i class="fas fa-tags"></i> sklearn</a>
            </li>
            
            <li>
                <a href="/tags/tensorflow"><i class="fas fa-tags"></i> tensorflow</a>
            </li>
            
            <li>
                <a href="/tags/tidyverse"><i class="fas fa-tags"></i> tidyverse</a>
            </li>
            
        </ul>
    </div>

</div>






                        

                    </div>
                    

                    

                </div>
                

            </div>
            
        </div>
        

        <footer id="footer">
    <div class="container">

        
        <div class="col-md-4 col-sm-6">
            <h4>About Me</h4>

            <p><p><ul><li>- I have been using Debian OS for 7 years.</li><li>- Brave is my default web browser.</li><li>- I like to watch 90&rsquo;s animes.</li><li>- I like go to camp.</li><li> - I like to cook typical Peruvian food :3.</li><li>- My preferred book is &lsquo;deep learning&rsquo; written by Ian Goodfellow.</ul></p>


            <hr class="hidden-md hidden-lg hidden-sm">

        </div>
        
        

        <div class="col-md-4 col-sm-6">

             
            <h4>Recent posts</h4>

            <div class="blog-entries">
                
                <div class="item same-height-row clearfix">
                    <div class="image same-height-always">
                        <a href="/blog/2019/10/10/landuseperu/">
                          
                            <img src="/img/banners/banner-1.jpg" class="img-responsive" alt="Download the GLC30 product for Peru and Ecuador">
                          
                        </a>
                    </div>
                    <div class="name same-height-always">
                        <h5><a href="/blog/2019/10/10/landuseperu/">Download the GLC30 product for Peru and Ecuador</a></h5>
                    </div>
                </div>
                
                <div class="item same-height-row clearfix">
                    <div class="image same-height-always">
                        <a href="/blog/2019/06/21/eetf2/">
                          
                            <img src="/img/banners/05_banner_ee.png" class="img-responsive" alt="Integrating Earth Engine with Tensorflow II - U-Net">
                          
                        </a>
                    </div>
                    <div class="name same-height-always">
                        <h5><a href="/blog/2019/06/21/eetf2/">Integrating Earth Engine with Tensorflow II - U-Net</a></h5>
                    </div>
                </div>
                
                <div class="item same-height-row clearfix">
                    <div class="image same-height-always">
                        <a href="/blog/2019/05/30/eetf/">
                          
                            <img src="/img/banners/04_banner_ee.png" class="img-responsive" alt="Integrating Earth Engine with Tensorflow I - DNN">
                          
                        </a>
                    </div>
                    <div class="name same-height-always">
                        <h5><a href="/blog/2019/05/30/eetf/">Integrating Earth Engine with Tensorflow I - DNN</a></h5>
                    </div>
                </div>
                
            </div>

            <hr class="hidden-md hidden-lg">
             

        </div>
        

        
        <div class="col-md-4 col-sm-6">

          <h4>Contact</h4>

            <strong>Lima</strong>
        <br>Ciudad Universitaria
        <br>Cercado de Lima 
        <br>15081
        <br>
        <strong>Peru</strong>
        <br>
        <br>

            <a href="/contact" class="btn btn-small btn-template-main">Go to contact page</a>

            <hr class="hidden-md hidden-lg hidden-sm">

        </div>
        
        

    </div>
    
</footer>







<div id="copyright">
    <div class="container">
        <div class="col-md-12">
            
            <p class="pull-left">Copyright (c) 2019, Cesar Aybar Camacho; all rights reserved.</p>
            
            <p class="pull-right">
              Template by <a href="https://bootstrapious.com/p/universal-business-e-commerce-template">Bootstrapious</a>.
              

              Ported to Hugo by <a href="https://github.com/devcows/hugo-universal-theme">DevCows</a>.
            </p>
        </div>
    </div>
</div>





    </div>
    

    
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-130564182-1', 'auto');
	
	ga('send', 'pageview');
}
</script>

<script src="//code.jquery.com/jquery-3.1.1.min.js" integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8=" crossorigin="anonymous"></script>
<script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<script src="//cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/waypoints/4.0.1/jquery.waypoints.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/Counter-Up/1.0/jquery.counterup.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/jquery-parallax/1.1.3/jquery-parallax.js"></script>

<script src="//maps.googleapis.com/maps/api/js?key=AIzaSyBWzxbqlK1u8n0bWqTgnYN7_M9u4LCgiYg&v=3.exp"></script>

<script src="/js/hpneo.gmaps.js"></script>
<script src="/js/gmaps.init.js"></script>
<script src="/js/front.js"></script>


<script src="/js/owl.carousel.min.js"></script>


  </body>
</html>
